<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Booking - Movitour</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { 
    background: url('./Imagenes/playa-dia.jpg') no-repeat center center fixed; 
    background-size: cover; 
    transition: background 0.5s ease-in-out; 
  }
  body.dark { 
    background: url('./Imagenes/playa-noche.jpg') no-repeat center center fixed; 
    background-size: cover; 
  }
</style>
</head>
<body class="text-white min-h-screen flex flex-col">

<!-- Header -->
<header class="w-full flex justify-between items-center p-4 absolute top-0 left-0">
  <!-- Logo -->
  <img id="bookingLogo" src="./Imagenes/Modelo logo.png" class="w-16 sm:w-20" alt="Logo">

  <!-- Dark mode toggle -->
  <button id="darkModeToggle" 
    class="bg-yellow-400 hover:bg-yellow-500 text-black px-3 py-1 rounded">
    üåô
  </button>
</header>

<!-- Main container -->
<main class="flex flex-1 justify-center items-center p-4 mt-16">
  <div class="bg-blue-800 bg-opacity-80 p-6 sm:p-8 rounded-2xl shadow-xl w-full max-w-md text-center">
    <h1 class="text-2xl font-bold mb-4">Reservas</h1>
    <form id="bookingForm" id="bookingForm" class="space-y-3">
      <input type="text" id="destination" placeholder="Destino" 
        class="w-full px-3 py-2 rounded text-black" required>
      <input type="date" id="bookingDate" 
        class="w-full px-3 py-2 rounded text-black" required>
      <input type="time" id="bookingTime" 
        class="w-full px-3 py-2 rounded text-black" required>
      <button type="submit" 
        class="w-full bg-yellow-400 hover:bg-yellow-500 text-black py-2 rounded font-bold">
        Reservar
      </button>
    </form>
    <div id="responseMessage" class="mt-4 text-sm"></div>
  </div>
</main>

<!-- Footer con bot√≥n Back -->
<footer class="w-full flex justify-center p-4">
  <button onclick="window.history.back()" 
    class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded">
    üîô Back
  </button>
</footer>

<script>
const darkToggle = document.getElementById('darkModeToggle');
const body = document.body;

// Persist dark mode
if(localStorage.getItem('darkMode') === 'true'){ 
  body.classList.add('dark'); 
  darkToggle.textContent = '‚òÄÔ∏è'; 
}

// Toggle dark mode
darkToggle.addEventListener('click',()=>{
  body.classList.toggle('dark');
  const isDark = body.classList.contains('dark');
  darkToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('darkMode', isDark);
});

// Handle booking
document.getElementById('bookingForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const token = localStorage.getItem('jwtToken');
  if(!token){ 
    alert("Debes iniciar sesi√≥n."); 
    window.location.href='login.html'; 
    return; 
  }

  const destination = document.getElementById('destination').value;
  const date = document.getElementById('bookingDate').value;
  const time = document.getElementById('bookingTime').value;

  try{
    const res = await fetch('http://localhost:3000/api/reservations',{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'Authorization':`Bearer ${token}`
      },
      body: JSON.stringify({ destination, date, time })
    });
    if(!res.ok){ 
      const err = await res.json(); 
      throw new Error(err.error || `HTTP ${res.status}`); 
    }
    const data = await res.json();
    document.getElementById('responseMessage').textContent = data.message || "¬°Reserva exitosa!";
  }catch(err){
    console.error(err);
    document.getElementById('responseMessage').textContent = `Error: ${err.message}`;
  }
});
</script>

<!-- Reserva: env√≠o al backend -->
<script>
(function(){
  // Hide Profile link when no token
  const token = localStorage.getItem('token');
  document.querySelectorAll('a[href="profile.html"]').forEach(a=>{
    a.style.display = token ? '' : 'none';
  });

  const form = document.getElementById('bookingForm') || document.querySelector('form');
  const msg = document.getElementById('responseMessage') || (function(){ const d=document.createElement('div'); d.id='responseMessage'; form.after(d); return d; })();
  form?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const nombre = document.getElementById('bookingName')?.value?.trim();
    const email = document.getElementById('bookingEmail')?.value?.trim();
    const ciudad = document.getElementById('bookingCity')?.value?.trim();
    const fecha = document.getElementById('bookingDate')?.value + ' ' + (document.getElementById('bookingTime')?.value || '00:00');
    const cantidad_personas = parseInt(document.getElementById('bookingPeople')?.value || '1', 10);

    msg.className = 'mt-4 text-sm';
    msg.textContent = 'Enviando...';

    try{
      const res = await fetch('http://localhost:3000/api/reservas', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nombre, email, ciudad, fecha, cantidad_personas })
      });
      const data = await res.json();
      if(!res.ok){
        throw new Error(data.error || 'Error al guardar la reserva');
      }
      msg.textContent = '‚úÖ Reserva creada. Estado: ' + (data.reserva?.estado || 'pendiente');
      form.reset();
    }catch(err){
      msg.textContent = '‚ùå ' + err.message;
      msg.classList.add('text-red-500');
    }
  });
})();
</script>

</body>
</html>




